[equations]
# Parameters / Exogenous
# Delta_t=0.01        # time step (0.01-0.1 s)
# m=1500              # vehicle mass (1000-2000 kg)
# I_e=0.1             # engine inertia (0.1-1 kg m^2)
# I_c                 # torque converter inertia (0.1-0.5 kg m^2)
# G                   # gear ratio Int(2-10)
# F_d                 # driving force on car (0-5000 N, variable depends on throttle)
# F_b                 # braking force on car (0-8000 N, variable depends on brake input)
# R                   # total resistance (rolling + drag) (100-1000 N, variable, depends on velocity)
# T_e                 # engine torque (0-400 Nm, variable, throttle-controlled)
# T_c                 # torque from engine to converter (0-400 Nm, variable, depends on slip conditions)
# T_w                 # torque from converter to wheels (0-5000 Nm, variable, depends on transmission, converter slip)

Delta_t = 0.01               # time step [s], typically constant
m = 1500                     # mass [kg], typically constant
I_e = 0.3                    # engine inertia [kg·m²], typically constant
I_c = 0.2                    # torque converter inertia [kg·m²], typically constant
G = 4                        # gear ratio, typically fixed per gear
r_wheel = 0.3                # wheel radius [m], typically constant
c_rr = 0.015                 # rolling resistance coefficient, constant
rho_air = 1.225              # air density [kg/m³], constant
Cd = 0.3                     # drag coefficient, constant
A_front = 2.2                # frontal area [m²], constant
g = 9.81                     # gravitational acceleration [m/s²], constant

T_e_max=400                  # [N.m]
F_b_max=8000                 # [N.m]
K_c=30                       # [N.m.s/rad]

throttle = u_throttle        # throttle input [0–1], exogenous variable
brake = u_brake              # brake input [0–1], exogenous variable

# Engine torque (depends directly on throttle input)
T_e = throttle * T_e_max           # T_e_max ≈ 400 Nm

# Slip between engine and converter (angular velocities)
converter_slip = omega_e - omega_c

# Torque from engine into converter, simple slip-based model
T_c = K_c * converter_slip         # K_c is torque converter stiffness constant (e.g., 20–50 Nm·s/rad)

# Torque transmitted from converter to wheels (through gear ratio)
T_w = T_c * G

# Driving force at wheels (from wheel torque)
F_d = T_w / r_wheel

# Aerodynamic drag force (depends on velocity squared)
F_drag = 0.5 * rho_air * Cd * A_front * V**2

# Rolling resistance force (depends linearly on velocity)
F_roll = c_rr * m * g

# Total resistance force (rolling + aerodynamic)
R = F_drag + F_roll

# Braking force (depends directly on brake input, scaled to max brake force)
F_b = brake * F_b_max               # F_b_max ≈ 8000 N


# State Updates
# x_{t+1}         = x_t + V_t * Delta_t
# V_{t+1}         = V_t + (Delta_t / m) * (F_d - F_b - R)
# omega_{e,t+1}   = omega_{e,t} + (Delta_t / I_e) * (T_e - T_c)
# omega_{c,t+1}   = omega_{c,t} + (Delta_t / I_c) * (T_c - T_w / G)

# Position update (linear motion)
x_next = x + V * Delta_t

# Velocity update (Newton’s law)
V_next = V + (Delta_t / m) * (F_d - F_b - R)

# Engine angular velocity update
omega_e_next = omega_e + (Delta_t / I_e) * (T_e - T_c)

# Torque converter angular velocity update
omega_c_next = omega_c + (Delta_t / I_c) * (T_c - T_w / G)


[domains]
omega_e_next: Int(0,10)
T_w: Int(0,10)
omega_c_next: Int(0,10)
brake: Int(0,10)
T_c: Int(0,10)
F_d: Int(0,10)
throttle: Int(0,10)
T_e: Int(0,10)
x_next: Int(0,10)
V_next: Int(0,10)
F_roll: Int(0,10)
F_drag: Int(0,10)
R: Int(0,10)
converter_slip: Int(0,10)
F_b: Int(0,10)
