[equations]

# Time step 1: Initial conditions
# Distance to obstacle at t1 (from radar/sensor)
dist_t1 = dist_t1_u

# Vehicle velocity at t1 (m/s)
vel_t1 = vel_t1_u

# Radar confidence in obstacle detection (0-1)
radar_conf_t1 = radar_conf_t1_u

# Time step 2: AEB system processing
# Distance decreases based on relative velocity
dist_t2 = max(0, dist_t1 - vel_t1 * 0.1)

# AEB system decides to brake based on distance and radar confidence
# Brakes if distance < 10m and radar confidence > 0.7
aeb_trigger_t2 = min(1, max(0, (10 - dist_t2) * radar_conf_t1))

# Braking force applied (0-1, where 1 is maximum braking)
brake_force_t2 = aeb_trigger_t2

# Deceleration due to braking (m/s^2, negative for deceleration)
decel_t2 = brake_force_t2 * 8.0

# Updated velocity after braking
vel_t2 = max(0, vel_t1 - decel_t2 * 0.1)

# Time step 3: Final outcome
# Final distance after another time step
dist_t3 = max(0, dist_t2 - vel_t2 * 0.1)

# Final velocity
vel_t3 = max(0, vel_t2 - decel_t2 * 0.1)

# Collision occurs if final distance <= 1m
collision = min(1, max(0, 2 - dist_t3))

# Collision severity based on final velocity (0-1 scale)
collision_severity = min(1, vel_t3 / 20.0)

[domains]
# Initial distance to obstacle (meters)
dist_t1_u: Float(5.0, 50.0)

# Initial velocity (m/s, roughly 0-72 km/h)
vel_t1_u: Float(5.0, 20.0)

# Radar confidence (0 = no detection, 1 = perfect detection)
radar_conf_t1_u: Float(0.0, 1.0)

# All computed variables
dist_t1, dist_t2, dist_t3: Float(0.0, 100.0)
vel_t1, vel_t2, vel_t3: Float(0.0, 25.0)
radar_conf_t1: Float(0.0, 1.0)
aeb_trigger_t2, brake_force_t2: Float(0.0, 1.0)
decel_t2: Float(0.0, 10.0)
collision, collision_severity: Float(0.0, 1.0)
